<?xml version='1.0' encoding='utf-8' standalone='yes'?>
<xst path='/$YS/TYPES/LoBlock/Common' m='{"attr":65}'>
  <i n='PID' s='{"cctor":{"LoBlock":"Common/PID"},"Children":{"Bottom":{"default":false,"ddr":-4,"manifest":{"attr":68},"rc":"X4"},"KD":{"default":0,"manifest":{"attr":69},"rc":"X23"},"KI":{"default":0,"manifest":{"attr":69},"rc":"X21"},"KP":{"default":0,"manifest":{"attr":69},"rc":"X22"},"PV":{"default":0,"ddr":-1,"manifest":{"attr":69},"rc":"X1"},"SP":{"ddr":-2,"default":0,"manifest":{"attr":69},"rc":"X1"},"T":{"default":10000,"manifest":{"attr":69},"rc":"X24"},"Top":{"default":false,"ddr":-3,"manifest":{"attr":68},"rc":"X3"},"U":{"ddr":1,"default":0,"manifest":{"attr":65},"rc":"X11"},"UMax":{"default":255,"manifest":{"attr":69},"rc":"X25"},"UMin":{"default":0,"manifest":{"attr":69},"rc":"X26"}},"default":"","hint":"Proportional Integral Derivative controller","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAKtJREFUOE+NkVEOAiEQQzka1zIxkaMRb+CXH/54Dn9qoWN3JLvGppkM8Mqw2QJcf7u1hqT9QJma6FjmzGHAVXZmXGP5eA7YJshziXLHzTaR7/ZOSBwbVvVaLvQFkGOCkrZikmk1+4Hs4CzvmljMo3WC5rIamm/Z5EwEskXgeV7MTGihfVxrZe29O0MT+P5xnwOirK/HSY08AD7J62xzbkT/GzBNHQb8DZkG8AZqhApaqZfdKgAAAABJRU5ErkJggg==","manifest":{"attr":66,"type":"LoBlock/Common/PID"},"namePrefix":"A","src":" class PID{\r\n  constructor(){\r\n    this.timer=null;\r\n    this.t = 0;\r\n    this.gt = false;\r\n    this.gb = false;\r\n    this.pt = Date.now(); \r\n    this.UI = 0;\r\n    this.OP = 0;\r\n    this.OE = 0;\r\n    setTimeout(this.Tick.bind(this), 1);\r\n  }\r\n  Calculate(pin){\r\n    let tmp = this.GetState(\"T\");\r\n    if(tmp!=this.t){\r\n      this.t = tmp;\r\n      if(this.timer!=null){\r\n        clearInterval(this.timer);\r\n      }\r\n      if(this.t&gt;0){\r\n        this.timer = setInterval(this.Tick.bind(this), this.t);\r\n      }\r\n    }\r\n    this.gt = this.GetState(\"Top\")?true:false;\r\n    this.gb = this.GetState(\"Bottom\")?true:false;\r\n  }\r\n  Tick(){\r\n    let now = Date.now();\r\n    let pv = this.GetState(\"PV\");\r\n    let e=this.GetState(\"SP\") - pv;\r\n    if(typeof(e)!=\"number\" || isNaN(e)){\r\n      return;\r\n    }\r\n    let dt = (now-this.pt)/1000;\r\n    let ki = this.GetState(\"KI\");\r\n    let uMax = this.GetState(\"UMax\");\r\n    let uMin = this.GetState(\"UMin\");\r\n    let U;\r\n    if(dt&gt;0){\r\n      if(ki!=0){\r\n        let ic=(e+this.OE)*dt*ki/2;\r\n        if((ic&gt;0 &amp;&amp; this.gt) || (ic&lt;0 &amp;&amp; this.gb)) {\r\n          ic=0;\r\n        } else {\r\n          this.UI+=ic;\r\n          if(this.UI&gt;uMax) {\r\n            this.UI=uMax;\r\n          } else if(this.UI&lt;uMin) {\r\n            this.UI=uMin;\r\n          }\r\n        }\r\n      } else {\r\n        this.UI = 0;\r\n      }\r\n      U = this.GetState(\"KP\")*e + this.UI + this.GetState(\"KD\")*(this.OP-pv)/dt;\r\n    } else {\r\n      U = this.GetState(\"KP\")*e; \r\n    }\r\n    if(U&gt;uMax) {\r\n      U=uMax;\r\n    } else if(U&lt;uMin) {\r\n      U=uMin;\r\n    }\r\n    this.OE = e;\r\n    this.OP = (this.OP+pv)/2;      \r\n    this.pt = now;\r\n    this.SetState(\"U\", U);\r\n  }\r\n}","willful":true}' m='{"attr":69,"type":"Ext/LBDescr"}' ver='0.4.1802.2002' />
</xst>