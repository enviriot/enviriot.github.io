<?xml version='1.0' encoding='utf-8' standalone='yes'?>
<xst path='/$YS/TYPES/LoBlock/Common' m='{"attr":65}'>
  <i n='Average' s='{"cctor":{"LoBlock":"Common/Average"},"Children":{"In":{"ddr":-1,"default":0,"manifest":{"attr":69},"rc":"X1"},"interval":{"default":60000,"manifest":{"attr":69}},"Out":{"default":0,"ddr":1,"manifest":{"attr":65},"rc":"X9"}},"default":"","hint":"Average","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMjHxIGmVAAAAZklEQVQ4T6WQ2w7AIAhD/f+fZjBk1hsDJTmmLaEPFiK6YhlmWIYZesPWwNyjCT36JlrSxG0BM02kBM00uQKRGfjtCzaMfwOjexMemxLdmfAYC6rXnYk/sOSoQJBDPH4zNCcswzhUHgG+7S9T0SYcAAAAAElFTkSuQmCC","manifest":{"attr":66,"type":"LoBlock/Common/Average"},"namePrefix":"A","src":"class Average{\r\n  constructor(){ \r\n    this.tm = null;\r\n    this.Calculate(\"interval\");\r\n  }\r\n  Calculate(pin){\r\n    if(this.tm==null){\r\n      this.SetState(\"Out\", this.GetState(\"In\"));\r\n    }\r\n    if(pin==\"interval\"){\r\n      if(this.tm != null){\r\n        clearInterval(this.tm); \r\n      }\r\n      this.interval = this.GetState(\"interval\");\r\n      if(this.interval &gt; 0){\r\n        this.tm = setInterval(this.Tick.bind(this), this.interval / 16);\r\n        this.SetField(\"In\", \"Arch\", { enable: true, keep: this.interval / (24 * 60 * 60 * 1000) });\r\n      }\r\n    }\r\n  }\r\n  Tick(){\r\n    let end = new Date(), start = new Date(end.getTime() - this.interval);\r\n    Arch.Query(this.path + \"/In\", start, 1, end).then(\r\n      val=&gt;{\r\n        let r = (Array.isArray(val) &amp;&amp; val.length &gt; 0) ? val[0][1] : this.GetState(\"In\");\r\n        this.SetState(\"Out\", r);\r\n      },\r\n      err=&gt;console.warning(this.path + \".tick() - \" + err));\r\n  }\r\n}","willful":true}' m='{"attr":69,"type":"Ext/LBDescr"}' ver='0.4.2307.7005' />
</xst>