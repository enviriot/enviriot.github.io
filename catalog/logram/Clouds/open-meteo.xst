<?xml version='1.0' encoding='utf-8' standalone='yes'?>
<xst path='/$YS/TYPES/LoBlock/Cloud' m='{"attr":65}'>
  <i n='open-meteo' s='{"cctor":{"LoBlock":"Cloud/open-meteo"},"Children":{"days":{"default":2,"manifest":{"attr":68,"editor":"Integer"}},"horly":{"manifest":{"attr":68,"editor":"String"},"default":""},"In":{"ddr":-1,"default":false,"manifest":{"attr":69},"rc":"X2"},"Lat":{"default":0,"manifest":{"attr":69,"editor":"Double"}},"Lon":{"default":0,"manifest":{"attr":69,"editor":"Double"}},"Q":{"ddr":1,"manifest":{"attr":65},"rc":"X1"}},"hint":"Wheather Forecast API on open-meteo.com","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAEKADAAQAAAABAAAAEAAAAAA0VXHyAAABdElEQVQ4Ea1TO0jDUBQ9eWlitdUuoVXET0Hwg3RRB8VRBJ0cnISO3QQHN0EcBHWSDi4u4uYmjioOTiqCIDiIH4QO0kWhLbWl+T3ve7GC0iG1HkhyeTnnvHOTdxW+iTUoWAGg01UPTHBsKHwLFVLVK65uZLIGxMJEFwYNoWGDgNg+X1Kwc9aCh2wAPYaDxakSYhEXV88aDi6DyNH7WIRjuMvCxZMOzoHkRBmT/RZkgu3jEAld7KfyGO+zsH4Ulm1l3lQMdtrYSxWQ6LZwm9GQXihgabqE9GlIcpjjAtcvGubHymBkN5uo4DXH8F70utMDHCqVI702HAcI0v8aIlPTBioWvAQikiL96EaFqGnpB1TG4fJvFhiVLpGYcB+NWzi8CcreTu6a0E79G2GK5gMy5/LMBx6zKpK7EZzfa1idK0qp0eoi2uZladaAeJRyf2Ggw5Yti5P4O22V4+vpfSlf1NqkfzEwa3v7WqVhopEk6l9M5Dh/AgoibkYX/IINAAAAAElFTkSuQmCC","manifest":{"attr":66,"type":"LoBlock/Cloud/open-meteo"},"namePrefix":"A","src":"class OpenMeteo{\r\n  constructor(){\r\n    this.timer = setTimeout(this.Tick.bind(this), (1+Math.random())*500);\r\n  }\r\n  Calculate(pin){\r\n    if(pin==&apos;In&apos; &amp;&amp; this.GetState(&apos;In&apos;)){\r\n      if(this.timer){\r\n        clearTimeout(this.timer);\r\n      }\r\n      this.timer = setTimeout(this.Tick.bind(this), 30);\r\n    }\r\n  }\r\n  Tick(){\r\n    let now = new Date();\r\n    this.timer = setTimeout(this.Tick.bind(this), ((60 - now.getUTCMinutes() + Math.random())*60 - now.getUTCSeconds()) *1000 - now.getUTCMilliseconds());\r\n    \r\n    this.xhr = new XMLHttpRequest();\r\n    let req = &apos;https://api.open-meteo.com/v1/forecast?timezone=auto&apos;;\r\n    \r\n    let tmp = this.GetState(&apos;Lon&apos;);\r\n    if(typeof (tmp) === &apos;number&apos; &amp;&amp; tmp&gt;-180 &amp;&amp; tmp&lt;180){\r\n      req+=&apos;&amp;longitude=&apos;+tmp.toString();\r\n    } else {\r\n      return;\r\n    }\r\n    \r\n    tmp = this.GetState(&apos;Lat&apos;);\r\n    if(typeof (tmp) === &apos;number&apos; &amp;&amp; tmp&gt;-180 &amp;&amp; tmp&lt;180){\r\n      req+=&apos;&amp;latitude=&apos;+tmp.toString();\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    tmp = this.GetState(&apos;days&apos;);\r\n    req+=&apos;&amp;forecast_days=&apos;+((typeof (tmp) === &apos;number&apos; &amp;&amp; tmp&gt;0 &amp;&amp; tmp&lt;=7)?(tmp|0):2).toString();\r\n\r\n    tmp = this.GetState(&apos;hourly&apos;);\r\n    if(!tmp || typeof(tmp) !== &apos;string&apos; || appId.length&lt;5){\r\n      tmp = &apos;temperature_2m,relativehumidity_2m,weathercode,windgusts_10m,uv_index,is_day,direct_radiation&apos;;\r\n    }\r\n    req+=&apos;&amp;hourly=&apos; + tmp;\r\n\r\n    this.xhr.open(&apos;GET&apos;, req);\r\n    this.xhr.onreadystatechange =  this.response.bind(this);\r\n    this.xhr.send();\r\n  }\r\n  response(){\r\n    if(this.xhr.readyState ==  4){\r\n      if(this.xhr.status == 200) {\r\n        try{\r\n          let wf = JSON.parse(this.xhr.responseText);\r\n          this.SetState(&apos;Q&apos;, wf);\r\n          return;\r\n        } catch(e){\r\n          console.warn(&apos;OM - &apos; + e);\r\n        }\r\n      }\r\n      console.warn(&apos;OM.response - state: &apos; + this.xhr.readyState + &apos;, status: &apos; + this.xhr.status);\r\n      this.SetState(&apos;List&apos;, []);\r\n    }\r\n  }\r\n}","willful":true}' m='{"attr":69,"type":"Ext/LBDescr"}' ver='0.4.2306.23384' />
</xst>